<script>
    // Sample data structure: Array of {teacher: string, week: string, minutes: number, month: string, year: '2025'}
    let logData = JSON.parse(localStorage.getItem('extraMinutes')) || [];

    // Fetch and display schedule from Lektioner.txt
    function loadSchedule() {
        fetch('Lektioner.txt')
            .then(response => response.text())
            .then(data => {
                const availabilityDiv = document.getElementById('availability');
                const lines = data.trim().split('\n');
                if (lines.length === 0 || lines[0].trim() === '') {
                    availabilityDiv.innerHTML = 'No teachers available right now.';
                    return;
                }
                let html = '<ul>';
                lines.forEach(line => {
                    const [teacher, time, status, date] = line.split(',');
                    html += `<li>${teacher.trim()} - ${time.trim()} (${status.trim()}) - ${date.trim()}</li>`;
                });
                html += '</ul>';
                availabilityDiv.innerHTML = html;
            })
            .catch(error => {
                document.getElementById('availability').innerHTML = 'Error loading schedule. Check Lektioner.txt.';
                console.error('Error:', error);
            });
    }

    // Update monthly total
    function updateMonthlyTotal() {
        const month = document.getElementById('monthSelect').value;
        const total = logData
            .filter(entry => entry.month === month && entry.year === '2025')
            .reduce((sum, entry) => sum + entry.minutes, 0);
        document.getElementById('monthlyTotal').innerHTML = `${total} minutes`;
    }

    // Populate log table
    function renderLog() {
        const tbody = document.querySelector('#logTable tbody');
        tbody.innerHTML = '';
        logData.forEach(entry => {
            const row = tbody.insertRow();
            row.insertCell(0).textContent = entry.teacher;
            row.insertCell(1).textContent = entry.week;
            row.insertCell(2).textContent = entry.minutes;
        });
    }

    // Export data
    function exportData() {
        const dataStr = JSON.stringify(logData, null, 2);
        const blob = new Blob([dataStr], {type: 'application/json'});
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = 'extra-minutes.json';
        a.click();
    }

    // Import data
    function importData() {
        document.getElementById('importFile').click();
    }

    function handleImport(event) {
        const file = event.target.files[0];
        if (file) {
            const reader = new FileReader();
            reader.onload = function(e) {
                logData = JSON.parse(e.target.result);
                localStorage.setItem('extraMinutes', JSON.stringify(logData));
                renderLog();
                updateMonthlyTotal();
                alert('Data imported!');
            };
            reader.readAsText(file);
        }
    }

    // Add sample entry (for testing - extend with a form)
    function addSampleEntry() {
        logData.push({
            teacher: 'Sample Teacher',
            week: 'Week 1',
            minutes: 30,
            month: '01', // January
            year: '2025'
        });
        localStorage.setItem('extraMinutes', JSON.stringify(logData));
        renderLog();
        updateMonthlyTotal();
    }

    // Load schedule on page load
    window.onload = loadSchedule;

    // Initial render
    renderLog();
    updateMonthlyTotal();
</script>
