<!DOCTYPE html>
<html lang="sv"> <!-- Set language to Swedish -->
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lärartillgänglighet</title> <!-- Swedish title -->
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        table { border-collapse: collapse; width: 100%; }
        th, td { border: 1px solid #ddd; padding: 8px; text-align: left; }
        th { background-color: #f2f2f2; }
        button { margin: 5px; padding: 8px 12px; }
        select { margin: 5px; padding: 5px; }
    </style>
</head>
<body>
    <h1>Lärartillgänglighet</h1> <!-- Swedish heading -->

    <h2>Tillgängliga just nu</h2> <!-- Swedish for "Available Right Now" -->
    <div id="availability">Laddar schema...</div> <!-- Swedish for "Loading schedule..." -->

    <h2>Extra Arbetade Minuter</h2> <!-- Swedish for "Extra Worked Minutes" -->
    <p>Dessa data lagras i din webbläsare. Använd Exportera/Importera-knapparna för att säkerhetskopiera eller återställa.</p> <!-- Swedish translation -->
    <button onclick="exportData()">Exportera Data</button> <!-- Swedish for "Export Data" -->
    <button onclick="importData()">Importera Data</button> <!-- Swedish for "Import Data" -->
    <input type="file" id="importFile" style="display: none;" onchange="handleImport(event)">

    <h3>Månadssummor</h3> <!-- Swedish for "Monthly Totals" -->
    <p>2025</p>
    <label>Välj en månad för att se totalen:</label> <!-- Swedish for "Select a month to see the total:" -->
    <select id="monthSelect" onchange="updateMonthlyTotal()">
        <option value="01">Januari</option>
        <option value="02">Februari</option>
        <option value="03">Mars</option>
        <option value="04">April</option>
        <option value="05">Maj</option>
        <option value="06">Juni</option>
        <option value="07">Juli</option>
        <option value="08">Augusti</option>
        <option value="09">September</option>
        <option value="10">Oktober</option>
        <option value="11">November</option>
        <option value="12">December</option>
    </select>
    <div id="monthlyTotal">0 minuter</div> <!-- Swedish for "0 minutes" -->

    <h3>Detaljerad Logg</h3> <!-- Swedish for "Detailed Log" -->
    <table id="logTable">
        <thead>
            <tr>
                <th>Lärare</th> <!-- Swedish for "Teacher" -->
                <th>Vecka</th> <!-- Swedish for "Week" -->
                <th>Minuter</th> <!-- Swedish for "Minutes" -->
            </tr>
        </thead>
        <tbody>
            <!-- Rows populated by JS -->
        </tbody>
    </table>
    <button onclick="addSampleEntry()">Lägg till Exempelpost</button> <!-- Swedish for "Add Sample Entry" -->

    <script>
        console.log("Script started");
        let logData = JSON.parse(localStorage.getItem('extraMinutes')) || [];

        function loadSchedule() {
            console.log("Fetching Lektioner.txt");
            fetch('Lektioner.txt')
                .then(response => {
                    console.log("Response received:", response);
                    if (!response.ok) throw new Error('Network response was not ok');
                    return response.text();
                })
                .then(data => {
                    console.log("Data received:", data);
                    const availabilityDiv = document.getElementById('availability');
                    const lines = data.trim().split('\n');
                    if (lines.length === 0 || lines[0].trim() === '') {
                        availabilityDiv.innerHTML = 'Inga lärare tillgängliga just nu.'; // Swedish
                        return;
                    }
                    let html = '<ul>';
                    lines.forEach(line => {
                        const [teacher, time, status, date] = line.split(',');
                        html += `<li>${teacher.trim()} - ${time.trim()} (${status.trim()}) - ${date.trim()}</li>`;
                    });
                    html += '</ul>';
                    availabilityDiv.innerHTML = html;
                })
                .catch(error => {
                    console.error("Fetch error:", error);
                    document.getElementById('availability').innerHTML = 'Fel vid laddning av schema. Kontrollera Lektioner.txt.'; // Swedish
                });
        }

        function updateMonthlyTotal() {
            const month = document.getElementById('monthSelect').value;
            const total = logData
                .filter(entry => entry.month === month && entry.year === '2025')
                .reduce((sum, entry) => sum + entry.minutes, 0);
            document.getElementById('monthlyTotal').innerHTML = `${total} minuter`;
        }

        function renderLog() {
            const tbody = document.querySelector('#logTable tbody');
            tbody.innerHTML = '';
            logData.forEach(entry => {
                const row = tbody.insertRow();
                row.insertCell(0).textContent = entry.teacher;
                row.insertCell(1).textContent = entry.week;
                row.insertCell(2).textContent = entry.minutes;
            });
        }

        function exportData() {
            const dataStr = JSON.stringify(logData, null, 2);
            const blob = new Blob([dataStr], {type: 'application/json'});
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'extra-minuter.json'; // Swedish
            a.click();
        }

        function importData() {
            document.getElementById('importFile').click();
        }

        function handleImport(event) {
            const file = event.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    logData = JSON.parse(e.target.result);
                    localStorage.setItem('extraMinutes', JSON.stringify(logData));
                    renderLog();
                    updateMonthlyTotal();
                    alert('Data importerad!'); // Swedish
                };
                reader.readAsText(file);
            }
        }

        function addSampleEntry() {
            logData.push({
                teacher: 'Exempel Lärare', // Swedish
                week: 'Vecka 1',
                minutes: 30,
                month: '10', // October
                year: '2025'
            });
            localStorage.setItem('extraMinutes', JSON.stringify(logData));
            renderLog();
            updateMonthlyTotal();
        }

        window.onload = loadSchedule;
        console.log("Initial render");
        renderLog();
        updateMonthlyTotal();
    </script>
</body>
</html>
